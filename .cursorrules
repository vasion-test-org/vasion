# Vasion Project AI Rules

This project uses **Tailwind CSS v4** (migrating from styled-components). Follow these rules for ALL code changes.

## BEFORE STARTING: Ask for Figma Link

**ALWAYS ask before creating or converting ANY component:**

> "Do you have a Figma MCP link for this component? I can use it to ensure pixel-perfect implementation."

Wait for the user's response before proceeding. If a Figma link is provided, use the Figma MCP tools to extract exact specs.

---

## Critical Rules

1. **ASK FOR FIGMA FIRST** - Always request Figma link before starting work
2. **PRESERVE EXACT STRUCTURE & BEHAVIOR** - Never add/remove containers; never simplify breakpoint logic
3. **ALWAYS use Tailwind CSS** - Never use styled-components for new code
4. **NO arbitrary px values** - No `w-[450px]`, use rem or closest Tailwind value
5. **ALWAYS use design tokens** - Defined in `@theme` block in `app/globals.css`
6. **ALWAYS ensure ADA compliance** - Alt text, focus states, semantic HTML
7. **Use `cn()` for conditionals** - Import from `@/lib/cn` (handles Tailwind conflicts)

## Tailwind v4 Configuration

This project uses **Tailwind CSS v4** with CSS-based configuration:

```css
/* app/globals.css */
@import 'tailwindcss';

@theme {
  --color-purple: #3d2562;
  --color-orange: #ff5100;
  --spacing-15: 3.75rem;
  --breakpoint-sm: 480px;
  /* ... all design tokens defined here */
}
```

**Key differences from v3:**

- No `tailwind.config.js` for theme customization (use `@theme` in CSS)
- Import with `@import "tailwindcss"` instead of `@tailwind base/components/utilities`
- Custom values defined as CSS custom properties in `@theme` block
- Custom utility classes use `@utility` directive (see below)

### Custom Utility Classes with @utility

For custom backgrounds, gradients, or complex styles, use `@utility` in `globals.css`:

```css
/* app/globals.css */
@utility bg-footer {
  background:
    linear-gradient(180deg, #201435 52%, rgba(32, 20, 53, 0) 100%),
    linear-gradient(270deg, #cc4800 1.74%, #5f47a8 99.26%), #201435;
}

@utility bg-purple-orbital {
  background: var(--gradient-purple-orbital);
}
```

**When to use @utility:**

- Custom gradients (complex backgrounds that can't be expressed as single values)
- Multi-layer backgrounds
- Any CSS that needs more than one property

## CRITICAL: Mobile-First Tailwind Approach

Tailwind uses **min-width** breakpoints, which means styles cascade UP from mobile. The base (no prefix) classes are mobile styles, and breakpoint prefixes add overrides for larger screens.

**Breakpoint mapping for styled-components → Tailwind:**
| Original styled-component | Tailwind | Range |
|---------------------------|----------|-------|
| `${media.mobile}` | **base (no prefix)** | 0-480px |
| `${media.tablet}` | `md:` | 481-1024px |
| Desktop (base in styled) | `lg:` | 1025-1600px |
| `${media.fullWidth}` | `xl:` | 1601px+ |

**How it works:**

- **Base classes** = mobile styles (smallest screen)
- **md:** = tablet styles (481px+), inherits to larger unless overridden
- **lg:** = desktop styles (1025px+), inherits to larger unless overridden
- **xl:** = fullWidth styles (1601px+)

**Example conversion:**

```jsx
// Original styled-component (desktop-first with max-width media queries):
const BioWrapper = styled.div`
  display: flex;
  flex-direction: row; /* Desktop default */
  width: 81.5vw; /* Desktop: 81.5vw × 16 = 1304px */
  gap: 1.875vw; /* Desktop: 1.875vw × 16 = 30px */

  ${media.fullWidth} {
    width: 1304px; /* FullWidth: 1304px */
    gap: 30px;
  }

  ${media.tablet} {
    width: 944px; /* Tablet: 944px */
    gap: 30px;
  }

  ${media.mobile} {
    flex-direction: column; /* Mobile: changes to column */
    width: 428px; /* Mobile: 428px */
    gap: 30px;
  }
`;

// Correct Tailwind conversion (mobile-first):
<div className={tw`lg:(flex-row w-326) flex w-107 flex-col gap-7.5 md:w-236`} />;

// Breakdown:
// - Base: flex-col (mobile), w-107 (428/4), gap-7.5 (30/4)
// - md: w-236 (944/4) - only width changes, flex-col inherited, gap same
// - lg: flex-row (desktop changes direction), w-326 (1304/4)
// - xl: not needed because lg: values carry through to fullWidth
```

**Key insight:** Only specify what CHANGES at each breakpoint. Unchanged values inherit from smaller breakpoints.

**Common patterns:**

```jsx
// Mobile: column, Tablet+: row
className={tw`flex flex-col md:flex-row`}

// Mobile: smaller, Desktop: larger
className={tw`w-50 lg:w-100`}

// Mobile: hidden, Tablet: visible
className={tw`hidden md:block`}

// Different values at each breakpoint
className={tw`h-425 md:h-320 lg:h-355 xl:h-320`}
```

---

## Converting VW to Tailwind

**Viewport widths for calculation:**

- Mobile (base): 480px → vw × 4.8 = px
- Tablet (md): 1024px → vw × 10.24 = px
- Desktop (lg): 1600px → vw × 16 = px
- FullWidth (xl): uses px values directly

**Formula:** `px = vw × (viewport / 100)` then `Tailwind number = px / 4`

### Step 1: Calculate px for EACH breakpoint (start with mobile)

```
Mobile:   vw × 4.8 = px    (base, no prefix)
Tablet:   vw × 10.24 = px  (md:)
Desktop:  vw × 16 = px     (lg:)
FullWidth: px / 4          (xl:)
```

### Step 2: Check if values CHANGE across breakpoints

**Case A: Same px at all breakpoints → ONE base class**
| Breakpoint | VW Value | Calculation | Result |
|------------|----------|-------------|--------|
| Mobile | 41.667vw | 41.667 × 4.8 = 200px | All same! |
| Tablet | 19.531vw | 19.531 × 10.24 = 200px | → w-50 |
| Desktop | 12.5vw | 12.5 × 16 = 200px | |

**Case B: Different px → Classes for breakpoints that CHANGE**
| Breakpoint | VW Value | Calculation | Tailwind |
|------------|----------|-------------|----------|
| Mobile | 353.738vw | 353.738 × 4.8 = 1698px | h-425 (base) |
| Tablet | 124.902vw | 124.902 × 10.24 = 1279px | md:h-320 |
| Desktop | 88.806vw | 88.806 × 16 = 1421px | lg:h-355 |
| FullWidth | 1279px | 1279 / 4 = 320 | xl:h-320 |

Result: `className="h-425 md:h-320 lg:h-355 xl:h-320"`

## PX to Tailwind Class

**Tailwind JIT generates any number automatically using**: `number × 0.25rem = size`

**To convert px to Tailwind class**: `px / 4 = Tailwind number`

Examples:

- 1304px / 4 = 326 → `w-326` (auto-generates 81.5rem)
- 1236px / 4 = 309 → `max-w-309` (auto-generates 77.25rem)
- 200px / 4 = 50 → `w-50`
- 100px / 4 = 25 → `w-25`

**DO NOT add custom values to tailwind.config.js** - Tailwind JIT handles it automatically.

```typescript
import { vwToRem, detectBreakpoint } from '@/lib/tailwind-utils';
```

## Quick Reference

### Imports to Use

```jsx
import { cn, tw } from '@/lib/cn';
import { cva, type VariantProps } from '@/lib/cva';
import Image from 'next/image';
```

### Variant Groups with `tw` (Tagged Template)

Use `tw` to group classes by breakpoint/variant:

```jsx
// Instead of repeating the prefix:
className="md:px-8 md:pt-20 md:pb-10"

// Use variant groups:
className={tw`md:(px-8 pt-20 pb-10)`}

// Works with hover, focus, etc:
className={tw`hover:(bg-purple text-white) focus:(ring-2 outline-none)`}

// Mix with regular classes:
className={tw`flex gap-4 md:(flex-row gap-6) lg:(gap-8 p-10)`}
```

### Class Ordering (IMPORTANT)

Prettier **cannot sort inside variant groups**. Manually maintain this order:

```jsx
// Correct order: base → md → lg → xl → state variants
className={tw`
  h-9 w-9 p-0 rounded bg-transparent      // 1. Base classes
  md:(h-8 w-8)                             // 2. Tablet
  lg:(h-9 w-9)                             // 3. Desktop
  xl:(h-8 w-8)                             // 4. FullWidth
  hover:bg-purple                          // 5. Hover state
  focus:(outline-none ring-2 ring-purple)  // 6. Focus state
`}
```

### Breakpoints (Mobile-First / min-width)

- **base (no prefix)** - mobile styles (0-480px)
- `md:` (481px+) - tablet and up
- `lg:` (1025px+) - desktop and up
- `xl:` (1601px+) - full width and up

**Remember:** Base = mobile, then add prefixes for larger screens.

### Common Colors (Tailwind v4 - no DEFAULT suffix)

In Tailwind v4, colors defined as `--color-orange` are used directly without `-DEFAULT`:

- Purple: `bg-purple`, `bg-purple-dark`, `bg-purple-light`, `border-purple-border`
- Orange: `bg-orange`, `text-orange`, `fill-orange`, `bg-orange-500`
- Teal: `bg-teal`, `bg-teal-500`
- Grey: `grey-800` to `grey-25`
- Text: `txt-primary`, `txt-subtle`

**NEVER use `-DEFAULT` suffix** (e.g., ❌ `text-orange-DEFAULT` → ✅ `text-orange`)

### Typography

- Headings: `text-h1` through `text-h5`
- Body: `text-body-xl`, `text-body-lg`, `text-body-md`, `text-body-sm`
- Special: `text-eyebrow`, `text-tag`, `text-subtle`
- Font: `font-archivo`, `font-orbitron`

### Gradients

- `bg-purple-orbital`, `bg-purple-gradient`, `bg-orange-gradient`
- `bg-light-purple`, `bg-dark-purple`, `bg-medium-purple`

## Component Template (Simple)

```jsx
// Only add 'use client' if needed for hooks/interactivity
'use client';

import { useState } from 'react';

import Image from 'next/image';

import { cn } from '@/lib/cn';

export default function ComponentName({ variant = 'default', className }) {
  return (
    <div
      className={cn(
        // Base styles
        'flex flex-col gap-4 p-6',
        // Responsive styles
        'md:flex-row md:gap-6 md:p-8',
        'lg:gap-8 lg:p-12',
        // Variant styles
        variant === 'primary' && 'bg-purple text-white',
        variant === 'secondary' && 'bg-grey-25 text-txt-primary',
        // Allow className override
        className
      )}
    >
      {/* Content with proper accessibility */}
      <Image
        src="/image.webp"
        alt="Descriptive alt text"
        width={400}
        height={300}
        className="rounded-lg"
      />
      <button className="bg-orange hover:bg-orange-dark rounded-md px-4 py-2 text-white transition-colors focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:outline-none">
        Button Text
      </button>
    </div>
  );
}
```

## Component Template (With CVA Variants)

```jsx
import { cva, type VariantProps } from '@/lib/cva';
import { cn } from '@/lib/cn';

const cardVariants = cva(
  'rounded-lg p-6 transition-shadow', // base styles
  {
    variants: {
      variant: {
        default: 'bg-white shadow-md',
        elevated: 'bg-white shadow-lg hover:shadow-xl',
        outlined: 'bg-transparent border border-grey-200',
      },
      size: {
        sm: 'p-4',
        md: 'p-6',
        lg: 'p-8 md:p-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'md',
    },
  }
);

type CardProps = VariantProps<typeof cardVariants> & {
  className?: string;
  children: React.ReactNode;
};

export default function Card({ variant, size, className, children }: CardProps) {
  return (
    <div className={cn(cardVariants({ variant, size }), className)}>
      {children}
    </div>
  );
}
```

## Converting styled-components

### CRITICAL: Preserve Exact Structure AND Behavior

**DO NOT move, remove, or add containers.** Convert each element 1:1.
**DO NOT simplify or "improve" the layout logic.** Match the original exactly.

**Rules:**

1. **Preserve exact HTML structure** - Same containers, same nesting order
2. **Preserve exact behavior per breakpoint** - If desktop uses margin and fullWidth uses fixed width + centering, convert BOTH approaches exactly as they are
3. **Never simplify** - Even if CSS seems redundant or could be "cleaner", match the original
4. **Each breakpoint is independent** - Different breakpoints may have completely different layout logic; preserve ALL of it

**Conversion Process (element by element):**

1. Start at outermost container
2. Read its styled-component CSS **for ALL breakpoints**
3. Convert CSS to Tailwind classes **for each breakpoint separately**
4. Move to the next nested child
5. Repeat until all elements converted
6. Verify behavior matches at EACH breakpoint (desktop, tablet, mobile, fullWidth)

**Example - CORRECT conversion:**

```jsx
// Original styled-components
const Wrapper = styled.section`padding: 60px;`;
const Container = styled.div`max-width: 1304px; margin: 0 auto;`;
const Inner = styled.div`display: flex; gap: 40px;`;

// CORRECT: Same 3 containers
<section className="p-15">
  <div className="max-w-326 mx-auto">
    <div className="flex gap-10">
```

**Example - Preserving different breakpoint behaviors:**

```jsx
// Original: Different layout approach at fullWidth vs desktop
const LegalDiv = styled.div`
  margin: 0 10.278vw;           /* Desktop: uses margin */
  ${media.fullWidth} {
    width: 1244px;              /* FullWidth: uses fixed width */
    align-self: center;         /* FullWidth: uses centering */
  }
`;

// CORRECT: Preserve BOTH approaches
<div className="mx-41 xl:mx-0 xl:w-311 xl:self-center">

// ❌ WRONG: Simplified to just one approach
<div className="max-w-311 mx-auto">  /* Lost the margin-based desktop behavior! */
```

**Example - WRONG conversion:**

```jsx
// ❌ WRONG: Removed Container, merged into section
<section className="p-15 max-w-326 mx-auto">
  <div className="flex gap-10">

// ❌ WRONG: Added extra wrapper
<section className="p-15">
  <div className="some-wrapper">  {/* This didn't exist! */}
    <div className="max-w-326 mx-auto">
```

### Step-by-Step Conversion:

1. Remove `import styled from 'styled-components'`
2. Replace `styled.div` with `<div className="...">`
3. Convert props-based styles to `cn()` conditionals
4. **Map breakpoints (mobile-first):**
   - `${media.mobile}` styles → **base (no prefix)**
   - `${media.tablet}` styles → `md:`
   - Desktop (base in styled) → `lg:`
   - `${media.fullWidth}` styles → `xl:`
5. Map `${colors.X}` to `text-X` or `bg-X`
6. Map `${text.X}` to `text-X font-archivo`
7. **For custom gradients**: Add `@utility` class in `globals.css` (see Tailwind v4 Configuration)
8. Add focus states to interactive elements
9. Ensure all images have alt text
10. Check heading hierarchy (h1 > h2 > h3)

## Server Components (CRITICAL for Performance)

**Always prefer Server Components** - only use `'use client'` when absolutely necessary.

### When to Use Server Components

- Static content rendering
- Data fetching
- Components that don't need interactivity
- Layout containers and wrappers

### When Client Components Are Required

- React hooks (`useState`, `useEffect`, `useContext`)
- Browser APIs (`window`, `document`)
- Event handlers that modify state
- Third-party libraries requiring client-side execution (GSAP, etc.)

### Extracting Client Logic Pattern

When a component needs GSAP or other client-only features, extract them:

```jsx
// ServerComponent.js (NO 'use client')
import CarouselAnimator from './CarouselAnimator';

const ServerComponent = ({ blok }) => {
  const shouldAnimate = blok.logos?.length > 5;

  return (
    <>
      {/* Static content renders server-side */}
      <div className="carousel">
        {blok.logos?.map((logo) => (
          <div className="carousel-item" key={logo.id}>
            ...
          </div>
        ))}
      </div>

      {/* Minimal client component for animation only */}
      {shouldAnimate && <CarouselAnimator selector=".carousel-item" />}
    </>
  );
};
```

### Reusable Client Components

Use `CarouselAnimator` for any horizontal loop animation:

```jsx
import CarouselAnimator from '@/components/CarouselAnimator';

// Basic usage
<CarouselAnimator selector=".my-items" />

// With options
<CarouselAnimator
  selector=".logo-items"
  options={{ speed: 0.5, reversed: true, draggable: true }}
/>
```

## CRITICAL: Pure Tailwind Only

**Never use inline styles or scoped `<style>` tags.** Use only Tailwind classes.

### Mobile-First Responsive Pattern (IMPORTANT)

**Always use mobile-first approach with standard Tailwind breakpoints:**

```jsx
// ✅ CORRECT: Mobile-first (base = mobile, larger breakpoints override)
className = 'px-7 md:px-8 lg:px-0'; // mobile → tablet → desktop

// ✅ CORRECT: Value changes only at some breakpoints
className = 'flex-col md:flex-row'; // column on mobile, row on tablet+

// ❌ WRONG: Desktop value as base
className = 'px-10 md:px-4'; // Don't put larger value as base
```

**Project breakpoints (min-width):**

- **base** → mobile (0-480px) - no prefix needed
- `md:` → 481px+ (tablet and up)
- `lg:` → 1025px+ (desktop and up)
- `xl:` → 1601px+ (fullWidth and up)

### Centering Elements with Max-Width (CRITICAL)

**ALWAYS add `mx-auto` when using `max-w-*` to center content:**

```jsx
// ✅ CORRECT: Centered card with max-width
<div className="w-full max-w-326 mx-auto">

// ❌ WRONG: Missing mx-auto - card will be left-aligned
<div className="w-full max-w-326">
```

### Converting VW Values

**Always calculate px for EACH breakpoint first, then determine if they're the same or different.**

```jsx
// Case A: All breakpoints target SAME px → ONE base class
// Mobile: 5vw × 4.8 = 24px
// Tablet: 2.344vw × 10.24 = 24px
// Desktop: 1.5vw × 16 = 24px
// All = 24px → py-6 (just base, no breakpoint prefixes needed)

// Case B: Breakpoints target DIFFERENT px → MOBILE as base, then breakpoints for changes
// Mobile: 353.738vw × 4.8 = 1698px → h-425 (base)
// Tablet: 124.902vw × 10.24 = 1279px → md:h-320
// Desktop: 88.806vw × 16 = 1421px → lg:h-355
// FullWidth: 1279px → xl:h-320
className = 'h-425 md:h-320 lg:h-355 xl:h-320';
```

### Theme-Based Styling with Inline Conditionals

Use ternary operators directly in `cn()` for cleaner code:

```jsx
import { cn } from '@/lib/cn';

<div
  className={cn(
    'w-full overflow-hidden mx-auto',
    // Background - inline ternary
    isTransparent ? 'bg-transparent' : theme === 'dark' ? 'bg-purple-dark' : 'bg-purple',
    // Text color
    theme === 'light' ? 'text-txt-primary' : 'text-white',
    // Max width
    isTransparent ? 'max-w-full' : 'max-w-326',
    // Padding (mobile-first: small → large)
    'p-10 lg:p-15',
    // Border radius
    'rounded-3xl'
  )}
>
```

### Lists

Use Tailwind's `list-none` class:

```jsx
<ul className="list-none m-0 p-0 flex gap-5">
  <li className="list-none flex-shrink-0">
```

## Conversion Checklist

When converting a styled-component:

1. **ASK FOR FIGMA LINK** - Request before starting (see top of file)
2. **Count containers first** - Note exactly how many wrapper elements exist
3. **Convert element by element** - Start at outer, work inward, never skip or merge
4. **Evaluate for Server Component** - Can it work WITHOUT `'use client'`?
   - If client code needed (GSAP): Extract to minimal client component like `CarouselAnimator`
5. **Preserve EXACT structure** - Same number of containers, same nesting order
6. **Handle ALL props** - Check original for props like:
   - `transparent_background` → affects width, padding, background
   - `offset_spacing` → affects vertical padding (top/bottom/both)
   - `section_spacing` → custom pixel spacing value
7. **Match values per breakpoint** - Calculate original vw → px → rem for EACH breakpoint
8. **Use mobile-first responsive** - Base styles for mobile, `md:`/`lg:`/`xl:` for larger screens
9. **Center with mx-auto** - Always add `mx-auto` when using `max-w-*`
10. **Test ALL breakpoints** - Desktop, tablet, mobile must match original
11. **Check outer wrapper** - Most components have section padding for spacing between components
12. **Remove `'use client'`** - After extracting client logic, verify main component is server-side
13. **Verify container count** - Final component must have same number of elements as original
14. **Clear browser cache** - Remind user to hard refresh or use incognito to see changes

## Reference: LogoCube Component Pattern

This is the gold standard for converted components:

```jsx
import Image from 'next/image';

import CarouselAnimator from './CarouselAnimator';
import { cn } from '@/lib/cn';

const LogoCube = ({ blok }) => {
  const isTransparent = blok.transparent_background;
  const theme = blok.theme || 'default';
  const offsetSpacing = blok.offset_spacing;

  return (
    <>
      <section
        aria-label="Trusted by leading companies"
        className={cn(
          'flex w-full items-center justify-center',
          // Mobile-first padding (base = mobile, md: = tablet+)
          'px-7 md:px-10',
          // Vertical padding based on props
          offsetSpacing === 'top' && 'pt-15 pb-0',
          offsetSpacing === 'bottom' && 'pt-0 pb-15',
          !offsetSpacing && 'py-15'
        )}
      >
        <div
          className={cn(
            // CRITICAL: mx-auto for centering with max-width
            'mx-auto w-full overflow-hidden',
            // Theme-based background (inline ternary)
            isTransparent ? 'bg-transparent' : theme === 'dark' ? 'bg-purple-dark' : 'bg-purple',
            // Theme-based text color
            theme === 'light' ? 'text-txt-primary' : 'text-white',
            // Conditional max-width
            isTransparent ? 'max-w-full' : 'max-w-326',
            // Padding and border radius
            'rounded-3xl p-15'
          )}
        >
          {/* Content */}
        </div>
      </section>

      {/* Client component for animation - conditionally rendered */}
      {shouldAnimate && <CarouselAnimator selector=".cubeLogos" />}
    </>
  );
};
```

## Validation

After making changes, remind user to run:

```bash
npm run checks
```

**IMPORTANT: Clear browser cache after conversions!**
Tailwind changes may not appear immediately due to caching. Tell the user to:

- Hard refresh (Cmd+Shift+R / Ctrl+Shift+R)
- Or open in incognito/private window
- Or clear browser cache

See detailed rules in:

- `.cursor/rules/tailwind-migration.mdc`
- `.cursor/rules/design-tokens.mdc`
- `docs/COMPONENT_OPTIMIZATION.md`
